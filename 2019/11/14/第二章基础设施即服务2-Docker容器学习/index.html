<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">第二章 基础设施即服务2：Docker容器学习 | M</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "さくら荘そのhojun";
  mashiro_option.author_name = "hojun";
  mashiro_option.site_url = "https://sakura.hojun.cn";
  mashiro_option.v_appId = "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz";
  mashiro_option.v_appKey = "mgOpfzbkHYqU92CV4IDlAUHQ";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(1).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(2).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(3).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(4).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(5).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(6).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(7).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(8).jpg.webp".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
</head>
</html>
<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://sakura.hojun.cn">
          <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/custom/avatar.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>Live your life with passion! With some drive!</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="http://github.com/honjun" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="http://weibo.com/mashirozx?is_all=1" target="_blank" class="social-github" title="sina">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/sina.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="http://weibo.com/mashirozx?is_all=1" target="_blank" class="social-github" title="wangyiyun">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/wangyiyun.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="http://weibo.com/mashirozx?is_all=1" target="_blank" class="social-github" title="zhihu">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/zhihu.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="http://weibo.com/mashirozx?is_all=1" target="_blank" class="social-github" title="email">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/email.svg">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/custom/wechat.jpg">
                  </div>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/custom/wechat.jpg">
                  </div>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">さくら荘その</span>
            <span class="shironeko">hojun</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/技术/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/生活/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          生活
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/资源/">
                          <i class="fa fa-cloud-download" aria-hidden="true"></i>
                          资源
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/随想/">
                          <i class="fa fa-commenting-o" aria-hidden="true"></i>
                          随想
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/转载/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          转载
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/tags/悦读/">
                          <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                          书单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/bangumi/">
                          <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                          番组
                        </a>
                      </li>
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          歌单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/tags/图集/">
                          <i class="fa fa-photo" aria-hidden="true"></i>
                          图集
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    友人帐
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/donate/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
                    赞赏
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我？
                        </a>
                      </li>
                    
                      <li>
                        <a href="/theme-sakura/">
                          <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                          主题
                        </a>
                      </li>
                    
                      <li>
                        <a href="/lab/">
                          <i class="fa fa-cogs" aria-hidden="true"></i>
                          Lab
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/client/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-android faa-vertical" aria-hidden="true"></i>
                    客户端
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/atom.xml">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
                    RSS
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
          <header class="entry-header">
            <h1 class="entry-title">第二章 基础设施即服务2：Docker容器学习</h1>
            <p class="entry-census">&nbsp;·&nbsp;2019-11-14&nbsp;·&nbsp;<span id="busuanzi_value_page_pv"></span>次阅读</p></p>

            <hr>
          </header>
        
        <div class="entry-content">
          <p><strong>目的：部署项目到Docker</strong></p>
<ul>
<li>Docker 简介<ul>
<li>什么是Docker</li>
<li>为什么要使用Docker</li>
</ul>
</li>
<li>Docker基本概念<ul>
<li>Docker 引擎</li>
<li>Docker架构</li>
<li>Docker镜像</li>
<li>Docker容器</li>
<li>Docker仓库</li>
</ul>
</li>
<li>安装Docker<ul>
<li>Ubuntu安装Docker</li>
<li>CentOS安装Docker</li>
<li>Raspberry安装Docker</li>
<li>macOS安装Docker</li>
<li>Windows安装Docker</li>
<li>Docker镜像加速器</li>
</ul>
</li>
<li>使用Docker镜像<ul>
<li>获取镜像</li>
<li>列出镜像</li>
<li>删除本地镜像</li>
<li>利用Commit理解镜像构成</li>
<li>使用Dockerfile定制镜像</li>
<li>Dockerfile指令详解</li>
</ul>
</li>
</ul>
<a id="more"></a>

<h1 id="什么是Docker——新型的虚拟化技术"><a href="#什么是Docker——新型的虚拟化技术" class="headerlink" title="什么是Docker——新型的虚拟化技术"></a>什么是Docker——新型的虚拟化技术</h1><p><em>真正实现一次编译，到处运行~</em><br><em>想做微服务，分布式开发的所有人，不仅是JAVA，都要掌握Docker</em></p>
<blockquote>
<p>Go语言开发，基于Linux内核的cgroup，namespaces，以及AUFS类的Union FS等技术，对程序进行封装隔离，属于<strong>操作系统层面的虚拟化技术</strong>。由于隔离的进程独立于宿主和其他的隔离进程，因此也称其为容器，最初实现层基于LXC<br><strong>里程碑版本：</strong>1.11–&gt;1.12<br>VM :硬件 server–&gt;虚拟化操作系统(Hpervisor)–&gt;操作系统(Linux,Windows..)</p>
</blockquote>
<h3 id="为什么使用Docker相关名词定义"><a href="#为什么使用Docker相关名词定义" class="headerlink" title="为什么使用Docker相关名词定义"></a>为什么使用Docker相关名词定义</h3><ul>
<li><p>更高效的利用系统资源</p>
</li>
<li><p>更快启动资源</p>
</li>
<li><p>一致的运行环境</p>
</li>
<li><p>持续交付和部署</p>
</li>
<li><p>更轻松的迁移</p>
</li>
<li><p>更轻松的维护和扩展</p>
<p><img src="//870727741.github.io/2019/11/14/第二章基础设施即服务2-Docker容器学习/1572441146144.png" alt="1572441146144"></p>
</li>
</ul>
<h2 id="Docker引擎"><a href="#Docker引擎" class="headerlink" title="Docker引擎"></a>Docker引擎</h2><p><em>是一个包含以下主要组件的 客户端 服务器 应用程序</em></p>
<ul>
<li><p>一种服务器</p>
</li>
<li><p>REST API用于指定程序可以用来与守护进程通讯的接口</p>
</li>
<li><p>一个有命令行（CLI）工具的客户端</p>
</li>
</ul>
<p><img src="//870727741.github.io/2019/11/14/第二章基础设施即服务2-Docker容器学习/1572441796976.png" alt="1572441796976"><br>*<em>管理-容器，镜像，网络，数据  *</em></p>
<h2 id="Docker架构"><a href="#Docker架构" class="headerlink" title="Docker架构"></a>Docker架构</h2><p>Docker使用C/S架构模式，使用远程API来管理和创建Docker容器。<br>Docker容器通过Docker镜像来创建<br>容器与镜像的关系类似于面向对象编程中的对象与类</p>
<p><img src="//870727741.github.io/2019/11/14/第二章基础设施即服务2-Docker容器学习/1572442678551.png" alt="1572442678551"></p>
<p><img src="//870727741.github.io/2019/11/14/第二章基础设施即服务2-Docker容器学习/1572442795039.png" alt="1572442795039"></p>
<h2 id="Docker仓库"><a href="#Docker仓库" class="headerlink" title="Docker仓库"></a>Docker仓库</h2><h3 id="公有仓库-Docker-Registry"><a href="#公有仓库-Docker-Registry" class="headerlink" title="公有仓库 Docker Registry"></a>公有仓库 Docker Registry</h3><p>官方的<a href="https://hub.docker.com/" target="_blank" rel="noopener">Docker Hub</a> ,CoreOS的Quay.io<br>国内访问这些服务比较慢，国内一些云服务商提供了针对DokerHub的镜像服务（Registry Mirror ），这些镜像服务被称为加速器，常见的有阿里云加速器，DaoCloud加速器等，使用加速器会直接从国内的网址下载Docker Hub镜像，速度会快很多<br>其他国内Docker加速器：时速云镜像仓库，DaoCloud镜像市场，阿里云镜像库</p>
<h3 id="私有仓库"><a href="#私有仓库" class="headerlink" title="私有仓库"></a>私有仓库</h3><p>商业化版本 Docker Trusted Registry,VMWare Harbor,Sonatype Nexus </p>
<h1 id="Ubuntu安装Docker"><a href="#Ubuntu安装Docker" class="headerlink" title="Ubuntu安装Docker"></a>Ubuntu安装Docker</h1><p>复制虚拟机系统镜像，创建Docker版虚拟机镜像（Ubuntu Server 64X Docker）<br><em>必须安装 64位 LTS（稳定发布版），Ubuntu CE社区版</em>（免费版）</p>
<h2 id="安装Docker-CE（用下一个自动化脚本安装方式）"><a href="#安装Docker-CE（用下一个自动化脚本安装方式）" class="headerlink" title="安装Docker CE（用下一个自动化脚本安装方式）"></a>安装Docker CE（用下一个自动化脚本安装方式）</h2><p>更新APT软件包缓存，并安装Docker-ce</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure>

<h2 id="使脚本自动安装"><a href="#使脚本自动安装" class="headerlink" title="使脚本自动安装"></a>使脚本自动安装</h2><p>在测试或开发环境中方，Docker官方为了简化安装流程，提供了一套便捷的安装脚本，Ubuntu系统上可以使用这套脚本安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#curl可以模拟各种请求协议向服务端发送请求，是一个很好用的接口测试命令行工具</span></span><br><span class="line"><span class="comment">#-o（小写的 o）：结果会被保存到命令行中提供的文件名docker</span></span><br><span class="line">curl  -fsSL get.docker.com -o get-docker.sh</span><br><span class="line"><span class="comment">##设置数据源</span></span><br><span class="line">sh get-docker.sh --mirror Aliyun</span><br><span class="line"><span class="comment">##检查安装结果</span></span><br><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p>执行这个命令后，脚本就会自动的将一切准备工作做好吧Docker CE的Edge版本安装在系统中。</p>
<h2 id="启动Docker-CE"><a href="#启动Docker-CE" class="headerlink" title="启动Docker CE"></a>启动Docker CE</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<p>Ubuntu <strong>14.04</strong>请使用以下命令启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service docker start</span><br></pre></td></tr></table></figure>

<h1 id="配置Docker镜像加速器"><a href="#配置Docker镜像加速器" class="headerlink" title="配置Docker镜像加速器"></a>配置Docker镜像加速器</h1><p>常见国内加速器</p>
<ul>
<li>Docker官方提供的中国 registry mirror</li>
<li>阿里云加速器</li>
<li><a href="https://www.daocloud.io/" target="_blank" rel="noopener">Dao加速器</a></li>
</ul>
<h2 id="Ubuntu-16-04-Debian-8-CentOS-7"><a href="#Ubuntu-16-04-Debian-8-CentOS-7" class="headerlink" title="Ubuntu 16.04+,Debian 8+,CentOS 7"></a>Ubuntu 16.04+,Debian 8+,CentOS 7</h2><p>对于使用systemd的系统，请在<strong>/etc/docker/daemon.json</strong>写入如下内容（如果文件不存在请新建改文件）</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="attr">"registry-mirrors"</span>: [</span><br><span class="line">                <span class="string">"https://registry.docker-cn.com"</span></span><br><span class="line">        ],</span><br><span class="line">        //docker根目录设置，--graph参数指定存储位置，docker安装的默认根目录/var/lib/docker不允许存放数据空间小</span><br><span class="line">        "graph": "/opt/docker/data"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意，一定要保证改文件符合json规范。否则Docker将不能启动。</strong><br>之后重新启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h2 id="测试docker镜像加速器"><a href="#测试docker镜像加速器" class="headerlink" title="测试docker镜像加速器"></a>测试docker镜像加速器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ docker info</span><br><span class="line">&gt;</span><br><span class="line">...</span><br><span class="line">Docker Root Dir: /opt/docker/data</span><br><span class="line">...</span><br><span class="line"> Registry Mirrors:</span><br><span class="line">  https://registry.docker-cn.com/</span><br><span class="line">...</span><br><span class="line"><span class="comment">##下载tomcat镜像</span></span><br><span class="line"><span class="comment">##下载默认版本</span></span><br><span class="line">$ docker pull tomcat</span><br><span class="line"><span class="comment">##下载指定版本的镜像，现在官方（docker hub）上寻找需要的镜像版本https://hub.docker.com/search?q=tomcat&amp;type=image</span></span><br><span class="line">$ docker pull tomcat:9-jre8</span><br><span class="line"><span class="comment">##运行tomcat,-P 随机端口，-p指定端口</span></span><br><span class="line"><span class="comment">##（宿主机）设置了一个8080端口，映射到tomcat的8080端口</span></span><br><span class="line">$ docker run -p 8080:8080 tomcat</span><br></pre></td></tr></table></figure>

<p>浏览器访问：<a href="http://ip:8080/" target="_blank" rel="noopener">http://ip:8080/</a></p>
<h1 id="Docker镜像-和-容器"><a href="#Docker镜像-和-容器" class="headerlink" title="Docker镜像  和 容器"></a>Docker镜像  和 容器</h1><p>镜像是Docker的三大组件之一<br>Docker运行容器前需要本地存在对相应的镜像，如果本地不存在该镜像，Docker会从镜像仓库下载该镜像</p>
<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><p><img src="//870727741.github.io/2019/11/14/第二章基础设施即服务2-Docker容器学习/1573177178172.png" alt="1573177178172"></p>
<h2 id="从仓库获取镜像"><a href="#从仓库获取镜像" class="headerlink" title="从仓库获取镜像"></a>从仓库获取镜像</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签] </span><br><span class="line">$ docker pull --<span class="built_in">help</span></span><br><span class="line"><span class="comment">## 获取Ubuntu镜像</span></span><br><span class="line">$ docker pull ibuntu:版本号</span><br></pre></td></tr></table></figure>

<h2 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##-it是两个参数，-i是交互式操作，-t是终端，进入bash执行一些命令，并返回结果，需要交互式终端</span></span><br><span class="line"><span class="comment">##--rm 容器退出后将其删除，测试用</span></span><br><span class="line"><span class="comment">##ubuntu:版本号 \ 使用Ubuntu为镜像起启动容器</span></span><br><span class="line"><span class="comment">##bash放在镜像名后镜像的命令，交互式shell</span></span><br><span class="line"><span class="comment">##通过exit退出容器，快捷键 CTRL+d</span></span><br><span class="line">root@unbuntu:~<span class="comment"># docker run -it  --rm\</span></span><br><span class="line">&gt; ubuntu:版本号 \</span><br><span class="line">&gt; bash</span><br></pre></td></tr></table></figure>

<h2 id="管理本机上的镜像和容器"><a href="#管理本机上的镜像和容器" class="headerlink" title="管理本机上的镜像和容器"></a>管理本机上的镜像和容器</h2><ul>
<li><strong>查看镜像列表信息</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker image ls</span><br><span class="line">$ docker images</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>虚悬镜像</strong><br>none:旧仓库名被取消产生的<br>docker pull/build都能产生</li>
<li><strong>删除镜像</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rmi 镜像名字（多个用空格隔开）</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>查看容器列表信息</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps [-a]</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>删除容器</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm 容器id</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>进入已存在的容器对象</strong><br><font color="red">以交互的方式进入容器，并启动容器</font></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">$ docker <span class="built_in">exec</span> -it 容器名字 bash</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>利用commit理解镜像构成</strong></li>
</ul>
<h2 id="定制镜像–Dockerfile"><a href="#定制镜像–Dockerfile" class="headerlink" title="定制镜像–Dockerfile"></a><strong>定制镜像–Dockerfile</strong></h2><h3 id="一-创建Dockerfile文件"><a href="#一-创建Dockerfile文件" class="headerlink" title="一 创建Dockerfile文件"></a>一 创建Dockerfile文件</h3><p>DockerFile是一个文本文件，包含了一条条的指令，每一条指令构建一层，因此每一条指令的内容，就是描述该层如何构建。<br>使用DockerFile来定制<font color="red">Nginx</font>镜像<br>在一个空白的目录中，新建一个文本文件，并命名为DockerFile：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir mynginx</span><br><span class="line">$ <span class="built_in">cd</span> mynginx</span><br><span class="line">$ touch DockerFile</span><br><span class="line"><span class="comment">#自己练习</span></span><br><span class="line">$ mkdir docker/mytomcat/epms</span><br><span class="line">$ touch Dockerfile</span><br></pre></td></tr></table></figure>

<h3 id="编写DockerFile脚本"><a href="#编写DockerFile脚本" class="headerlink" title="编写DockerFile脚本"></a>编写DockerFile脚本</h3><p>其内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM nginx</span><br><span class="line">RUN echo &apos;&lt;h1&gt;hello,Docker!&lt;/h1&gt;&apos; /usr/share/nginx/html/index.html</span><br></pre></td></tr></table></figure>

<p>涉及到命令<font color="red">FROM</font>和<font color="red">RUN</font><br>FROM指定基础镜像<br>RUN 命令行命令</p>
<ul>
<li>shell格式 RUN &lt;命令&gt; </li>
<li>exec格式：RUN [“可执行文件”,”参数1”,”参数2”]</li>
</ul>
<h3 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h3><ul>
<li>在Dokerfile文件目录执行以下：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##名字和标签，不给标签默认为latest,".":1 Dokerfile目录 2 构建镜像上下文（Context）</span></span><br><span class="line">$ docker build -t nginx[:v1] .</span><br></pre></td></tr></table></figure>

<p><font color="red">docker build</font>工作原理</p>
<blockquote>
<p>Docker在运行时分为Docker引擎（也就是服务端守护进程）和客户端工具。引擎提供了一组REST API，被称为Docker Remote API，而如<font color="red">docker</font>命令这样的客户端工具，则是通过这组API和Docker引擎交互，从而完成各种功能吗，表面上我们是在docker本机执行各种font color=red&gt;docker功能，实际上一切都是使用远程调用的形式在服务器（Docker引擎）完成。C/S设计，远程操作服务器Docker引擎。<br>构建镜像过程：<br>构建是，用户会指定镜像的上下文路径，<font color="red">docker build</font>得知这个命令后，会将这个路径下的所有内容打包，然后上传给Docker引擎，Docker引擎收到这个上下文后，展开就会获得构建镜像所需要的一切文件。</p>
</blockquote>
<h4 id="示例：定制Tomcat镜像"><a href="#示例：定制Tomcat镜像" class="headerlink" title="示例：定制Tomcat镜像"></a>示例：定制Tomcat镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##交互式启动 一个tomcat镜像 命令行，了解镜像目录结构，其所放置位置</span></span><br><span class="line">root@ubuntuserver:~<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">tomcat              latest              882487b8be1d        2 weeks ago         507MB</span><br><span class="line">root@ubuntuserver:~<span class="comment"># docker run -it --rm tomcat bash</span></span><br><span class="line">root@10d3619ade0e:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cd webapps/</span></span><br><span class="line">root@10d3619ade0e:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@ubuntuserver:~<span class="comment"># docker ps -a</span></span><br><span class="line"><span class="comment">##根据查看的目录结构创建文件夹</span></span><br><span class="line">root@ubuntuserver:~<span class="comment"># cd /usr/local</span></span><br><span class="line">root@ubuntuserver:/usr/<span class="built_in">local</span><span class="comment"># mkdir docker</span></span><br><span class="line">root@ubuntuserver:/usr/<span class="built_in">local</span><span class="comment"># cd docker/</span></span><br><span class="line">root@ubuntuserver:/usr/<span class="built_in">local</span>/docker<span class="comment"># mkdir mytomcat</span></span><br><span class="line">root@ubuntuserver:/usr/<span class="built_in">local</span>/docker<span class="comment"># cd mytomcat/</span></span><br><span class="line">root@ubuntuserver:/usr/<span class="built_in">local</span>/docker/mytomcat<span class="comment"># vi Dockerfile</span></span><br><span class="line"><span class="comment">##写入以下内容</span></span><br><span class="line">FROM tomcat</span><br><span class="line">WORKDIR  /usr/<span class="built_in">local</span>/tomcat/webapps/ROOT</span><br><span class="line">RUN rm -fr *</span><br><span class="line">RUN <span class="built_in">echo</span> <span class="string">"&lt;h1&gt;hello,Docker Tomcat!&lt;h1&gt;"</span> &gt; /usr/<span class="built_in">local</span>/tomcat/webapps/ROOT/index.html</span><br><span class="line"><span class="comment">##构建镜像</span></span><br><span class="line">docker build -t mytomcat .</span><br><span class="line"><span class="comment">##删除虚悬镜像</span></span><br><span class="line">docker image prune</span><br><span class="line"><span class="comment">##运行镜像</span></span><br><span class="line"><span class="comment">##运行tomcat,-P 随机端口，-p指定端口</span></span><br><span class="line"><span class="comment">##（宿主机）设置了一个8080端口，映射到tomcat的8080端口</span></span><br><span class="line">docker run -p 8080:8080 mytomcat</span><br><span class="line"><span class="comment">##访问localhost:8080</span></span><br></pre></td></tr></table></figure>

<h3 id="Dockerfile文件指令详解"><a href="#Dockerfile文件指令详解" class="headerlink" title="Dockerfile文件指令详解"></a>Dockerfile文件指令详解</h3><table>
<thead>
<tr>
<th>指令</th>
<th>说明</th>
<th>格式</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>COPY</td>
<td>复制文件，从构建上下文中源文件的路径，到新的一层的镜像内的目标路径位置</td>
<td>COPY 原本路径 目标路径      （源路径可以是多个，甚至可以使用通配符，其通配符要满足GO的filepath.Match规则）</td>
<td>COPY package.json /usr/src/app，COPY hom* /mydir/,COPY hom？.txt /mydir/</td>
</tr>
<tr>
<td>ADD</td>
<td>复制文件，若源文件为tar包，会自动解压缩</td>
<td>COPY 原本路径 目标路径（源路径可以是一个URL）</td>
<td></td>
</tr>
<tr>
<td>CMD</td>
<td>容器启动命令</td>
<td>shell:CMD &lt;命令&gt;,exec: CMD [“可执行文件”，”参数1“，”参数2“…]</td>
<td></td>
</tr>
<tr>
<td>ENTRYPOINT</td>
<td>入口点</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ENV</td>
<td>配置环境变量（个人理解，就是设置了一个全局静态变量）</td>
<td>ENV <key> <value>,ENV <key1>=<value1>  <key2>=<value2>…</value2></key2></value1></key1></value></key></td>
<td>EVN CATALINA_HOME /usr/local/tomcat,EVN PATH $CATALINA_HOME/bin:$PATH</td>
</tr>
<tr>
<td>VOLUME</td>
<td>定义匿名卷</td>
<td></td>
<td></td>
</tr>
<tr>
<td>EXPOSE</td>
<td>暴漏端口号</td>
<td>EXPOSE &lt;端口号1&gt; [&lt;端口号2&gt; …]</td>
<td>EXPOSE 8080（来自官方Tomcat镜像）</td>
</tr>
<tr>
<td>WORKDIR</td>
<td>指定活动工作路径</td>
<td></td>
<td></td>
</tr>
<tr>
<td>RUN</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>FROM</td>
<td>设置基础镜像源</td>
<td>From 官方镜像名称</td>
<td>FROM tomcat</td>
</tr>
</tbody></table>
<h3 id="部署项目到Docker容器"><a href="#部署项目到Docker容器" class="headerlink" title="部署项目到Docker容器"></a>部署项目到Docker容器</h3><ol>
<li><p>拷贝项目.zip (war)-&gt;tomcat/webappps/ROOT</p>
<p>Dockerfile文档编写</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM tomcat</span><br><span class="line">WORKDIR /usr/<span class="built_in">local</span>/tomcat/webapps/ROOT</span><br><span class="line">RUN rm -fr *</span><br><span class="line">COPY 项目.zip .</span><br><span class="line">RUN unzip 项目.zip</span><br><span class="line">RUN rm -fr 项目.zip</span><br><span class="line">WORKDIR /usr/<span class="built_in">local</span>/tomcat</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改端口号为 80</p>
<p><img src="//870727741.github.io/2019/11/14/第二章基础设施即服务2-Docker容器学习/1573261294732.png" alt="1573261294732"></p>
<p><img src="//870727741.github.io/2019/11/14/第二章基础设施即服务2-Docker容器学习/1573261229899.png" alt="1573261229899"></p>
</li>
</ol>
<h2 id="介绍镜像实现的基本原理"><a href="#介绍镜像实现的基本原理" class="headerlink" title="介绍镜像实现的基本原理"></a>介绍镜像实现的基本原理</h2><h2 id="操作Docker容器"><a href="#操作Docker容器" class="headerlink" title="操作Docker容器"></a>操作Docker容器</h2><h3 id="启动命名容器"><a href="#启动命名容器" class="headerlink" title="启动命名容器"></a>启动命名容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -p 80:8080 --name tomcat tomcat</span><br><span class="line"><span class="comment">##重启容器</span></span><br><span class="line">$ docker 容器id restart</span><br><span class="line">$ docker restart tomcat (容器名字)</span><br></pre></td></tr></table></figure>

<h4 id="守护态运行容器——后台运行"><a href="#守护态运行容器——后台运行" class="headerlink" title="守护态运行容器——后台运行"></a>守护态运行容器——后台运行</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -p 80:8080 --name tomcat -d  tomcat</span><br><span class="line"><span class="comment">##利用不同端口映射启动同一个tomcat镜像，实现负载均衡</span></span><br><span class="line">Last login: Fri Nov  8 06:18:42 2019 from 192.168.47.1</span><br><span class="line">root@ubuntuserver:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">root@ubuntuserver:~<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mytomcat            latest              75a4afc8edd6        21 hours ago        507MB</span><br><span class="line">tomcat              latest              882487b8be1d        3 weeks ago         507MB</span><br><span class="line">root@ubuntuserver:~<span class="comment"># docker run -p 8081:8080 --name mytomcat1 -d mytomcat</span></span><br><span class="line">bbf6ed566fe22002bc45f69e345ff6578ee7755fdaee6392b799593c4401aa99</span><br><span class="line">root@ubuntuserver:~<span class="comment"># docker run -p 8082:8080 --name mytomcat2 -d mytomcat</span></span><br><span class="line">d545bae836765b1d2bc47d96e3594ab664435ee43d9edb0b69299ac54196ba61</span><br></pre></td></tr></table></figure>

<p><img src="//870727741.github.io/2019/11/14/第二章基础设施即服务2-Docker容器学习/1573268637616.png" alt="1573268637616"></p>
<h3 id="终止容器"><a href="#终止容器" class="headerlink" title="终止容器"></a>终止容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop 容器名字</span><br><span class="line">docker container stop 容器名字|容器ID</span><br><span class="line"><span class="comment">##删除未运行的容器</span></span><br><span class="line">$ docker container prune</span><br></pre></td></tr></table></figure>

<h4 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##删除容器</span></span><br><span class="line">$ docker rm [-f] 容器id</span><br></pre></td></tr></table></figure>

<h4 id="整体流程实例"><a href="#整体流程实例" class="headerlink" title="整体流程实例"></a>整体流程实例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##启动容器</span></span><br><span class="line">$ docker run -p 80:8080 --name tomcat tomcat</span><br><span class="line"><span class="comment">##终止容器</span></span><br><span class="line">$ docker stop 容器名字</span><br><span class="line"><span class="comment">##退出容器</span></span><br><span class="line">$ <span class="built_in">exit</span>|ctrl+d</span><br><span class="line"><span class="comment">##查看容器</span></span><br><span class="line">$ docker ps [-a]</span><br><span class="line">$ docker container ls -a</span><br><span class="line"><span class="comment">##重启容器</span></span><br><span class="line">$ docker 容器ID restart</span><br><span class="line"><span class="comment">##删除容器</span></span><br><span class="line">$ docker rm [-f] 容器id</span><br></pre></td></tr></table></figure>

<h1 id="Docker-仓库"><a href="#Docker-仓库" class="headerlink" title="Docker 仓库"></a>Docker 仓库</h1><h2 id="Docker-Hub"><a href="#Docker-Hub" class="headerlink" title="Docker Hub"></a>Docker Hub</h2><blockquote>
<p>公共仓库 <a href="https://hub.docker.com/" target="_blank" rel="noopener">Docker Hub</a> </p>
</blockquote>
<hr>
<blockquote>
<p>注册：可以再<a href="https://cloud.docker.com" target="_blank" rel="noopener">https://cloud.docker.com</a>免费注册一个Docker账号<br>登录：docker login<br>退出：docker logout<br>查找镜像：docker search tomcat|centos|jmp/tomcat(用户名/镜像) –filter-stars-n(过滤收藏数量为n以上的镜像)<br>拉取镜像：docker pull tomcat<br>推送镜像：<br>docker tag ubuntu:17.10 username/ubuntu:17.10<br>docker image ls<br>docker push  username/mytomcat(自己的镜像)</p>
</blockquote>
<h3 id="自动创建"><a href="#自动创建" class="headerlink" title="自动创建"></a>自动创建</h3><p>自动创建功能对于对于经常升级镜像内程序来说十分方便。<br>有时候，用户创建了镜像，安装了某个软件，如果软件更新则需要手动更新镜像。</p>
<p>而自动创建允许用户通过Docker Hub 指定跟踪一个目标网站（目前支持GitHub和BItBucket）上的项目，一旦项目发生新的提交或者创建新的标签（tag），Docker Hub会自动构建镜像并推送到Docker Hub 中。</p>
<blockquote>
<p>配置自动创建步骤如下：</p>
<ol>
<li>创建并登陆Docker Hub,以及目标网站；</li>
<li>在目标网站中连接账户到Docker Hub；</li>
<li>在Docker Hub中配置一个 自动创建；</li>
<li>选取一个目标网站中的项目（需要含有Dockerfiel）和分支；<ol start="5">
<li>指定Dockerfile的位置，并提交创建</li>
<li>之后可以在Docker Hub的自动创建页面中跟踪每次创建的状态。</li>
</ol>
</li>
</ol>
</blockquote>
<h2 id="Docker-私用仓库"><a href="#Docker-私用仓库" class="headerlink" title="Docker 私用仓库"></a>Docker 私用仓库</h2><p><strong>第三章——镜像管理平台 中讲解</strong></p>
<h2 id="数据卷！"><a href="#数据卷！" class="headerlink" title="数据卷！"></a>数据卷！</h2><p><font color="red">数据卷</font>是一个可以供一个或多个容器使用的特使目录，她绕过UFS，可以提供很多有用的特性</p>
<ul>
<li>数据卷可以在容器之间共享和重用</li>
<li>对数据卷的修改可以立马生效</li>
<li>对数据卷的更新，不会影响镜像</li>
<li>数据卷默认会一直存在，即使容器被删除</li>
</ul>
<p><strong>注意：</strong>数据卷的使用，类似于Linux下对目录或文件进行mount，镜像中的被指定为挂载点的目录中的文件会隐藏掉，能显示看的是挂载的数据卷<br>参数选择</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##新用户选择，推荐使用</span></span><br><span class="line">--mount</span><br><span class="line"><span class="comment">##经验丰富的Docker使用者</span></span><br><span class="line">-v</span><br><span class="line">--volume</span><br><span class="line"><span class="comment">##创建一个数据卷</span></span><br><span class="line">docker volume create my -vol</span><br><span class="line"><span class="comment">##查看所有的数据卷</span></span><br><span class="line">docker volume ls</span><br><span class="line"><span class="comment">##主机里使用以下命令可以查看指定数据卷的信息</span></span><br><span class="line">$ docker volume inspect my-vol</span><br><span class="line"><span class="comment">##守护态，命名为tomcat端口号映射为8081启动镜像tomcat，使用数据卷，将/usr/local/docker/mytomcat/ROOT的文件映射到镜像中的/usr/local/tomcat/webapps/ROOT tomcat</span></span><br><span class="line">$ docker run -p 8081:8080 --name tomcat -d -v /usr/<span class="built_in">local</span>/docker/mytomcat/ROOT:/usr/<span class="built_in">local</span>/tomcat/webapps/ROOT tomcat</span><br></pre></td></tr></table></figure>

<p><img src="//870727741.github.io/2019/11/14/第二章基础设施即服务2-Docker容器学习/1573480831648.png" alt="1573480831648"></p>
<p>数据卷可以共用</p>
<h1 id="Docker-部署数据库"><a href="#Docker-部署数据库" class="headerlink" title="Docker 部署数据库"></a>Docker 部署数据库</h1><h2 id="下载数据库镜像"><a href="#下载数据库镜像" class="headerlink" title="下载数据库镜像"></a>下载数据库镜像</h2><p><em>数据库版本参考MySQL版本特性.md</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull mysql:5.7.22</span><br><span class="line"><span class="comment">##启动mysql，docker配置数据库可以参考docker mysql官方文档</span></span><br><span class="line">$ docker run -p 3306:3306 --name mysql \</span><br><span class="line">-v /usr/<span class="built_in">local</span>/docker/jmysql/conf:/etc/mysql \</span><br><span class="line">-v /usr/<span class="built_in">local</span>/docker/jmysql/logs:/var/<span class="built_in">log</span>/mysql \</span><br><span class="line">-v /usr/<span class="built_in">local</span>/docker/jmysql/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql:5.7.22</span><br><span class="line"></span><br><span class="line"><span class="comment">##查看目录结构</span></span><br><span class="line">$ whereis mysql</span><br><span class="line"><span class="comment">##远程导入数据库sql文件失败</span></span><br><span class="line"><span class="comment">##配置远程导入sql文件的配置</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it mysql bash</span><br><span class="line">$ <span class="built_in">cd</span> /etc/mysql/conf.d</span><br><span class="line">$ cat mysqldump.cnf</span><br><span class="line"><span class="comment">#复制 max_allowed_packet=16M</span></span><br><span class="line">$ <span class="built_in">exit</span> </span><br><span class="line"><span class="comment">##停止正在运行的Mysql容器</span></span><br><span class="line">$ docker rm 容器id</span><br><span class="line">$ docker run -p 3306:3306 --name mysql \</span><br><span class="line">-v /usr/<span class="built_in">local</span>/docker/jmysql/logs:/var/<span class="built_in">log</span>/mysql \</span><br><span class="line">-v /usr/<span class="built_in">local</span>/docker/jmysql/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql:5.7.22</span><br><span class="line"><span class="comment">##以交互方式进入容器</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it mysql bash</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /etc/mysql/mysql.conf.d</span><br><span class="line">$ <span class="built_in">echo</span> max_allowed_packet=16M &gt;&gt; mysqld.cnf</span><br><span class="line">$ <span class="built_in">exit</span></span><br><span class="line"><span class="comment">#重启容器</span></span><br><span class="line">$ docker restart mysql</span><br></pre></td></tr></table></figure>

<h2 id="（本地）远程连接服务器Docker-MySQL"><a href="#（本地）远程连接服务器Docker-MySQL" class="headerlink" title="（本地）远程连接服务器Docker MySQL"></a>（本地）远程连接服务器Docker MySQL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ip</span><br><span class="line">用户：root</span><br><span class="line">密码：root</span><br><span class="line">端口：33061</span><br></pre></td></tr></table></figure>

<h3 id="失败-10061-2013可能原因"><a href="#失败-10061-2013可能原因" class="headerlink" title="失败 10061 2013可能原因"></a>失败 10061 2013可能原因</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker mysql 2013 - Lost connection to MySQL server at &apos;reading initial communication packet&apos;, system error: O &quot;Internal error/check (Not system error)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>解决方案</strong>：认真检车创建MySQL容器的语句，端口映射是否有误</p>
</blockquote>
<h2 id="是数据库数据及配置持久化"><a href="#是数据库数据及配置持久化" class="headerlink" title="是数据库数据及配置持久化"></a>是数据库数据及配置持久化</h2><ul>
<li><p><em>将容器的文件复制到宿主机</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/local/docker/Jmysql/conf</span><br><span class="line">#复制容器中mysql相关的配置文件到宿主机自定义文件夹下</span><br><span class="line">$ dockr cp mysql:/etc/mysql .</span><br><span class="line">$ cd mysql/</span><br><span class="line">$ mv *.*  ..</span><br><span class="line">$ rm -fr mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p><em>配置本地数据卷映射镜像数据目录创建启动容器</em></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 停止并删除原有MySQL容器</span></span><br><span class="line">$ docker stop mysql</span><br><span class="line">$ docker rm mysql </span><br><span class="line"><span class="comment">#配置宿主机数据卷守护态启动MySQL</span></span><br><span class="line">$ docker run -p 3306:3306 --name mysql \</span><br><span class="line">-v /usr/<span class="built_in">local</span>/docker/jmysql/conf:/etc/mysql \</span><br><span class="line">-v /usr/<span class="built_in">local</span>/docker/jmysql/logs:/var/<span class="built_in">log</span>/mysql \</span><br><span class="line">-v /usr/<span class="built_in">local</span>/docker/jmysql/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql:5.7.22</span><br></pre></td></tr></table></figure>

<h1 id="项目的容器化部署"><a href="#项目的容器化部署" class="headerlink" title="项目的容器化部署"></a>项目的容器化部署</h1><ol>
<li>将项目部署的zip文件传输到服务器，放在自定义的 /usr/local/docker/jtomcat/项目名/ROOT 目录下并解压</li>
<li>修改项目数据源为数据库地址</li>
<li>创建启动挂载宿主机数据卷的tomcat<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -p 8080:8080 --name 项目名 -v /usr/<span class="built_in">local</span>/docker/jtomcat/项目名/ROOT:/usr/<span class="built_in">local</span>/tomcat/webapps/ROOT -d tomcat</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="查看容器日志"><a href="#查看容器日志" class="headerlink" title="查看容器日志"></a>查看容器日志</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker logs [-f] 容器名</span><br></pre></td></tr></table></figure>

<h2 id="Docker-常用命令总结"><a href="#Docker-常用命令总结" class="headerlink" title="Docker 常用命令总结"></a>Docker 常用命令总结</h2><h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h2><h2 id="Docker-Compose-简介、安装与卸载"><a href="#Docker-Compose-简介、安装与卸载" class="headerlink" title="Docker Compose 简介、安装与卸载"></a>Docker Compose 简介、安装与卸载</h2><p><strong>Docker Compose 是Docker官方编排项目之一，负责快速部署分布式应用。</strong>Compose是Docker官方的开源项目，负责实现对Docker容器集群的快速编排。从功能上看，跟OpenStack中的Heat十分类似。</p>
<p>Compose的定位是定义和运行多个Docker容器应用，其前身是开源项目Fig.</p>
<p>Compose允许用户通过一个单独的<font color="red">docker-compose.yml</font>模板文件，来定义一组关联的应用容器为一个项目。</p>
<p>Compose中有两个重要概念：</p>
<ul>
<li><font color="red">服务（service）:</font>一个应用的容器，实际上可以包括若干运行相同镜像的容器实例</li>
<li><font color="red">项目（project）:</font>由一组关联的应用容器完成的一个完整业务单元，在<font color="red">docker-compose.yml</font>文件中定义。</li>
<li>Compose 默认的管理对象是项目，通过子命令对项目中的一组容器进行便捷的生命周期管理。</li>
<li>Compose 项目有Pyhon编写，实现上调用了Docker服务提供的API对容器进行管理，因此，只要操作的平台支持 Docker API ，就可以利用Compose进行编排管理。</li>
</ul>
<h2 id="Docker-Compose-使用"><a href="#Docker-Compose-使用" class="headerlink" title="Docker Compose 使用"></a>Docker Compose 使用</h2><p>Compose 支持Linux ，MacOS，Windows 10三大平台。</p>
<p>Compose 可以通过Python的包管理工具PIP进行安装，也可以直接下载编译好的二进制文件使用，甚至能够直接在Docker容器中运行。</p>
<p>前两种是传统方式，适合在本地环境下安装使用，最后一种方式则不破话系统环境，更适合云计算场合。</p>
<h3 id="Linux系统安装Compose"><a href="#Linux系统安装Compose" class="headerlink" title="Linux系统安装Compose"></a>Linux系统安装Compose</h3><ul>
<li><p><strong>二进制包</strong></p>
<p>从官方<a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener">Github Release</a>直接下载编译好的二进制文件即可。</p>
<p>例如，在Linux x64位系统上直接下载对应的二进制包。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##(官网上有这个链接,找新的复制即可)在安装docker之后直接执行这一步</span></span><br><span class="line">$ curl -L https://github.com/docker/compose/releases/download/1.25.0-rc4/docker-compose-`uname -s`-`uname -m` -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>

<ul>
<li>更改权限为可执行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/bin/</span><br><span class="line">$ chmod +x docker-compose </span><br><span class="line">$ docker-compose version</span><br></pre></td></tr></table></figure>

<ul>
<li>卸载docker-compose</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"><span class="comment">##如果是通过PIP安装的,则执行以下命令</span></span><br><span class="line">$ sudo pip uninstall docker-compose</span><br></pre></td></tr></table></figure>

<h2 id="Docker-Compose-命令"><a href="#Docker-Compose-命令" class="headerlink" title="Docker Compose 命令"></a>Docker Compose 命令</h2><h3 id="命令选项"><a href="#命令选项" class="headerlink" title="命令选项"></a>命令选项</h3><table>
<thead>
<tr>
<th>命令选项</th>
<th>命令选项说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>-f,–file FILE</td>
<td>指定使用的Compose模板文件，默认为docker-compose.yml，可以指定多次</td>
<td></td>
</tr>
<tr>
<td>-p,–project-name NAME</td>
<td></td>
<td></td>
</tr>
<tr>
<td>–x -nerworking</td>
<td>使用Docker的可拔插网络后端特性</td>
<td></td>
</tr>
<tr>
<td>–x-network-driver DRIVER</td>
<td>指定网路后端的驱动，默认为bridge</td>
<td></td>
</tr>
<tr>
<td>–verbose</td>
<td>输出更多调试信息</td>
<td></td>
</tr>
<tr>
<td>-v,–version</td>
<td>打印版本并退出</td>
<td></td>
</tr>
</tbody></table>
<h3 id="命令使用说明"><a href="#命令使用说明" class="headerlink" title="命令使用说明"></a>命令使用说明</h3><ul>
<li><p><font color="red">build</font></p>
<p>格式为<font color="red">docker-compose build [options] [SERVICE…]</font></p>
<p>构建（重新构建）项目中的服务容器</p>
<p>服务容器一旦构建后，将会带上一个标记名，</p>
<table>
<thead>
<tr>
<th>命令选项</th>
<th>命令选项说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>–force-rm</td>
<td>删除构建过程中的临时容器</td>
<td></td>
</tr>
<tr>
<td>–no-cache</td>
<td>构建镜像过程中不使用cache(这将加长构建过程)</td>
<td></td>
</tr>
<tr>
<td>–pull</td>
<td>始终尝试通过pull来获取和更新版本的镜像</td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p><font color="red">config：</font>验证Compose文件格式是否正确</p>
</li>
<li><p><font color="red">down：</font>此命令将会停止<font color="red">up</font>命令所启动的容器，并移除网络</p>
</li>
<li><p><font color="red">exec：</font>进入指定的容器</p>
</li>
<li><p><font color="red">help：</font>获取命令帮助</p>
</li>
<li><p><font color="red">images：</font>列出Compse文件中所包含的镜像</p>
</li>
<li><p><font color="red">kil：</font></p>
<p>格式为<font color="red">docker-compose kill [options] [SERVICE…]</font></p>
<p>通过发送SIGKILL信号来强制停止服务容器</p>
<p>支持通过<font color="red">-s</font>参数来指定发送的信号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose <span class="built_in">kill</span> -s SIGINT</span><br></pre></td></tr></table></figure>
</li>
<li><p><font color="red">logs：</font></p>
<p>格式为<font color="red">docker-compose logs [options] [SERVICE…]</font></p>
<p><font color="red">–no-color</font>来关闭日志颜色</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose logs -f tomcat</span><br></pre></td></tr></table></figure>
</li>
<li><p><font color="red">pause：</font></p>
<p>格式为<font color="red">docker-compose pause [SERVICE…]</font></p>
<p>暂停一个服务容器</p>
</li>
<li><p><font color="red">port：</font></p>
<p>格式为<font color="red">docker-compose port [options] SERVICE PRIVATE_PORT</font></p>
<p>打印某个容器端口所映射的公共端口</p>
<table>
<thead>
<tr>
<th>命令选项</th>
<th>命令选项说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>–protocol-proto</td>
<td>指定端口协议，tcp(默认)或者udp</td>
<td></td>
</tr>
<tr>
<td>–index-index</td>
<td>如果同一个服务存在多个容器，指定命令对象容器的序号（默认为1）</td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p><font color="red">ps：</font></p>
<p>格式为<font color="red">docker-compose port [options]  [SERVICE…]</font></p>
<p>列出目前项目中所有的容器</p>
<p><font color="red">-q</font>只打印容器ID信息</p>
</li>
<li><p><font color="red">push</font></p>
</li>
<li><p><font color="red">restart</font></p>
</li>
<li><p><font color="red">rm</font></p>
</li>
</ul>
<h3 id="Docker-Compose模板文件"><a href="#Docker-Compose模板文件" class="headerlink" title="Docker Compose模板文件"></a>Docker Compose模板文件</h3><table>
<thead>
<tr>
<th>指令</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>build</td>
<td>指定Dockerfile文件夹路径，自动构建镜像</td>
<td></td>
</tr>
<tr>
<td>cap_add,cap_drop</td>
<td>指定容器的内核能力分配</td>
<td></td>
</tr>
<tr>
<td>command</td>
<td>容器启动后默认执行的命令</td>
<td></td>
</tr>
<tr>
<td>configs</td>
<td></td>
<td></td>
</tr>
<tr>
<td>cgroup_parent</td>
<td></td>
<td></td>
</tr>
<tr>
<td>container_name</td>
<td>指定容器名</td>
<td></td>
</tr>
<tr>
<td>deploy</td>
<td></td>
<td></td>
</tr>
<tr>
<td>devices</td>
<td>指定容器映射关系</td>
<td></td>
</tr>
<tr>
<td>depends_on</td>
<td>解决容器的依赖，启动先后的问题</td>
<td></td>
</tr>
<tr>
<td>dns</td>
<td>自定义DNS服务，可以是一个值，也可以是一个列表</td>
<td></td>
</tr>
<tr>
<td>dns_serach</td>
<td>配置DNS搜索域</td>
<td></td>
</tr>
<tr>
<td>tmpfs</td>
<td>挂载一个tmpfs文件系统到容器</td>
<td></td>
</tr>
<tr>
<td>env_file</td>
<td>从文件中获取环境变量，可以为单独的文件路径或列表</td>
<td></td>
</tr>
<tr>
<td>environment</td>
<td>设置环境变量，可以使用数组或字典两种风格</td>
<td></td>
</tr>
<tr>
<td>expose</td>
<td>暴露端口号</td>
<td></td>
</tr>
<tr>
<td>external_links</td>
<td>不建议使用</td>
<td></td>
</tr>
<tr>
<td>extra_hosts</td>
<td></td>
<td></td>
</tr>
<tr>
<td>healthcheck</td>
<td></td>
<td></td>
</tr>
<tr>
<td>image</td>
<td>指定镜像名或镜像ID，如果不存在，或尝试pull</td>
<td></td>
</tr>
<tr>
<td>labels</td>
<td>为容器添加Docker元数据信息，例如可以为容器添加辅助说明信息</td>
<td></td>
</tr>
<tr>
<td>links</td>
<td>不推荐使用</td>
<td></td>
</tr>
<tr>
<td>logging</td>
<td>配置日志选项</td>
<td></td>
</tr>
<tr>
<td>network_mode</td>
<td>设置网络模式</td>
<td></td>
</tr>
<tr>
<td>networks</td>
<td>配置容器连接的网络</td>
<td></td>
</tr>
<tr>
<td>pids</td>
<td>跟主机共享进程命名空间，打开该选项的容器和宿主机系统之间可以通过进程id来互相访问和操作</td>
<td></td>
</tr>
<tr>
<td>ports</td>
<td>暴露端口信息，宿主机端口：容器端口，或者仅仅指定容器的端口都可以</td>
<td></td>
</tr>
<tr>
<td>secrets</td>
<td>存储敏感数据，例如mysql服务密码</td>
<td></td>
</tr>
<tr>
<td>security_opt</td>
<td></td>
<td></td>
</tr>
<tr>
<td>sysctls</td>
<td>配置容器内核参数</td>
<td></td>
</tr>
<tr>
<td>ulimits</td>
<td>指定容器的ulimits限制值</td>
<td></td>
</tr>
<tr>
<td></td>
<td>数据卷所挂载路径设置，可以设置宿主机路径或加上访问模式 宿主机路径：容器内路径</td>
<td></td>
</tr>
</tbody></table>
<h3 id="Docker-Compoe使用：启动一个tomcat"><a href="#Docker-Compoe使用：启动一个tomcat" class="headerlink" title="Docker Compoe使用：启动一个tomcat"></a>Docker Compoe使用：启动一个tomcat</h3><ul>
<li>新建编写docker-compose.yml文件（Compose使用的主模板文件）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/docker/jtomcat/projectNmae</span><br><span class="line">$ vi docker-compose.yml</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span> </span><br><span class="line"><span class="attr">  tomcat:</span></span><br><span class="line"><span class="attr">   restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">   image:</span> <span class="string">tomcat</span></span><br><span class="line"><span class="attr">   container_name:</span> <span class="string">tomcat</span></span><br><span class="line"><span class="attr">   ports:</span> </span><br><span class="line"><span class="bullet">    -</span> <span class="number">8080</span><span class="string">:8080</span></span><br><span class="line"><span class="bullet">    -</span> <span class="number">8081</span><span class="string">:8080</span></span><br><span class="line"><span class="bullet">    -</span> <span class="number">7080</span><span class="string">:8080</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span> </span><br><span class="line"><span class="attr">  tomcat:</span></span><br><span class="line"><span class="attr">   restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">   image:</span> <span class="string">tomcat</span></span><br><span class="line"><span class="attr">   container_name:</span> <span class="string">tomcat</span></span><br><span class="line"><span class="attr">   ports:</span> </span><br><span class="line"><span class="bullet">    -</span> <span class="number">8080</span><span class="string">:8080</span></span><br><span class="line"><span class="bullet">    -</span> <span class="number">8081</span><span class="string">:8080</span></span><br><span class="line"><span class="bullet">    -</span> <span class="number">7080</span><span class="string">:8080</span></span><br><span class="line"><span class="attr">   volumes:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">"/usr/local/docker/jtomcat/webapps:/user/local/tomcat/webapps"</span></span><br><span class="line"><span class="attr">   mysql:</span> </span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">mysql:5.7.28</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">    ports:</span> </span><br><span class="line"><span class="bullet">     -</span> <span class="number">3306</span><span class="string">:3306</span></span><br><span class="line"><span class="attr">    environment:</span> </span><br><span class="line"><span class="attr">     TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"><span class="attr">     MYSQL_ROOT_PASSWORD:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    command:</span> </span><br><span class="line"><span class="bullet">     -</span><span class="bullet">-character-set-server=utf8mb4</span></span><br><span class="line"><span class="bullet">     -</span><span class="bullet">-collation-server=utf8mb4_general_ci</span></span><br><span class="line"><span class="bullet">     -</span><span class="bullet">-explicit_defaults_for_timestamp=true</span></span><br><span class="line"><span class="bullet">     -</span><span class="bullet">-max_allowed_packet=128M</span></span><br><span class="line"><span class="bullet">     -</span><span class="bullet">-sql-mode="STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO"</span></span><br><span class="line"><span class="attr">    volumes:</span> </span><br><span class="line"><span class="attr">     - mysql-data:</span><span class="string">/var/lib/mysql</span></span><br><span class="line"><span class="attr">volumes:</span> </span><br><span class="line"><span class="attr"> mysql-data:</span></span><br></pre></td></tr></table></figure>

<p>Docker管理的数据卷(volumes:  mysql-data: )未设置情况下默认放在/usr/lib/docker/volums/</p>
<ul>
<li>启动</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##守护态启动</span></span><br><span class="line">$ docker-compose up -d</span><br><span class="line">$ docker-compose logs -f tomcat</span><br><span class="line">$ docker-compose down</span><br></pre></td></tr></table></figure>

<ul>
<li>浏览器访问<blockquote>
<p><a href="http://192.168.0.100:7080/" target="_blank" rel="noopener">http://192.168.0.100:7080/</a></p>
<p><a href="http://192.168.0.100:8080/" target="_blank" rel="noopener">http://192.168.0.100:8080/</a></p>
<p><a href="http://192.168.0.100:8081/" target="_blank" rel="noopener">http://192.168.0.100:8081/</a></p>
</blockquote>
</li>
</ul>
<p>参考资料：<a href="https://www.bilibili.com/video/av36042649/?p=2" target="_blank" rel="noopener">2018千锋Java高级教程-Java微服务架构（Spring Boot + Spring Cloud）</a></p>
<blockquote>
<p>声明：文档为学习总结，可能参考了网络学习资料(自己没发现)，如有侵权纠纷请直接email  <a href="mailto:kyrd@qq.com" target="_blank" rel="noopener">kyrd@qq.com</a></p>
</blockquote>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/custom/donate/AliPayQR.jpg"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/custom/donate/WeChanQR.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2019/11/14/第三章PaaS-平台即服务/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                第三章 PaaS :平台即服务</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2019/11/14/第二章基础设施即服务1-Linux入门学习/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                第二章 基础设施即服务1：Linux入门学习</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz",
        appKey: "mgOpfzbkHYqU92CV4IDlAUHQ",
        path: window.location.pathname,
        placeholder: "你是我一生只会遇见一次的惊喜 ..."
      })
  }
</script>

      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="" class="profile gravatar"><img src="" itemprop="image" alt="" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="" itemprop="url" rel="author"></a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i></p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            // PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Monica Jia<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2018</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>
<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/custom/avatar.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">さくら荘そのhojun</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/honjun" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="http://weibo.com/mashirozx?is_all=1" class="fa fa-weibo" target="_blank" style="color: #dd4b39; margin-left:20px"></a>
      
        <a href="https://wpa.qq.com/msgrd?v=3&uin=954655431&site=qq&menu=yes" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/技术/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/生活/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  生活
                </a>
              </li>
            
              <li>
                <a href="/categories/资源/">
                  <i class="fa fa-cloud-download" aria-hidden="true"></i>
                  资源
                </a>
              </li>
            
              <li>
                <a href="/categories/随想/">
                  <i class="fa fa-commenting-o" aria-hidden="true"></i>
                  随想
                </a>
              </li>
            
              <li>
                <a href="/categories/转载/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  转载
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/tags/悦读/">
                  <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                  书单
                </a>
              </li>
            
              <li>
                <a href="/bangumi/">
                  <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                  番组
                </a>
              </li>
            
              <li>
                <a href="/music/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  歌单
                </a>
              </li>
            
              <li>
                <a href="/tags/图集/">
                  <i class="fa fa-photo" aria-hidden="true"></i>
                  图集
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            友人帐
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/donate/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
            赞赏
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我？
                </a>
              </li>
            
              <li>
                <a href="/theme-sakura/">
                  <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                  主题
                </a>
              </li>
            
              <li>
                <a href="/lab/">
                  <i class="fa fa-cogs" aria-hidden="true"></i>
                  Lab
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/client/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-android faa-vertical" aria-hidden="true"></i>
            客户端
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/atom.xml">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
            RSS
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    id="2660651585"

    server="netease"

    type="playlist"

    fixed="true"

    autoplay="false"

    loop="all"

    order="random"

    preload="auto"

    volume="0.7"

    mutex="true"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>